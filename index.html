<!DOCTYPE HTML>
<!--
	Introspect by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
	<head>
		<title>Introspect by TEMPLATED</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
                <script type="text/javascript" src="papaparse.min.js"></script>
                <meta name="viewport" content="width=624">
                <script type="text/javascript">
                    function onLoad() {
                        var setCurrentList = function() {
                            var element = document.getElementById("resourceList");
                            var html = "";
                            var searchVal = document.getElementById("searchBox").value;
                            var alwaysFree = document.getElementById("alwaysFree").checked;	
                            var subject = document.getElementById("subjectValue").value;
                            var level = document.getElementById("levelValue").value;	
			    console.log(subject);
			    console.log(level);
                            searchVal = searchVal.toLowerCase().trim();
                            var allMatching;
                            var topMatches = [];
                            var otherMatches = [];
                            if (searchVal.trim() != "" || alwaysFree || subject || level) {
                                allResources.data.map(function(resource, index) {
				    if (alwaysFree &&
					    !(resource["Free Service Offered"] &&
						resource["Free Service Offered"]
						    .toLowerCase().includes("always free"))) {
					return;
				    }
				    if (subject &&
					    !(resource["Category/Subject"] &&
						resource["Category/Subject"]
						    .toLowerCase().includes(subject.toLowerCase()))) {
					return;
				    }
				    if (level &&
					    !(resource["Grade/Age Group"] &&
						resource["Grade/Age Group"]
						    .toLowerCase().includes(level.toLowerCase()))) {
					return;
				    }
                                    var allText = resource["Category/Subject"] + " " +
                                        resource["Grade/Age Group"] + " " +
                                        resource["Description"] + " " +
                                        resource["Company"] + " " +
                                        resource["Free Service Offered"];
                                    // first do a check for the whole search string
                                    allText = allText.toLowerCase();
                                    if (allText.includes(searchVal)) {
                                        topMatches.push(resource);
                                    } else {
                                        var words = allText.split(" ");
                                        var matches = false;
                                        words.map(function(word, index) {
                                            if (word.startsWith(searchVal)) {
                                                matches = true;
                                            }
                                        });
                                        if (matches) {
                                            otherMatches.push(resource);
                                        }
                                    }
                                });
                                allMatching = topMatches.concat(otherMatches);
                            } else {
                                allMatching = allResources.data;
                            }
                            allMatching.map(function(resource, index) {
                                if (!resource["Link"]) {
                                    return;
                                }
                                if (! (resource["Link"].startsWith("http://") ||
                                       resource["Link"].startsWith("https://"))
                                ) {
                                    resource["Link"] = "http://" + resource["Link"];
                                }
                                html += "<a href=\"" + resource["Link"]
                                    + "\" style=\"max-width:100%;text-overflow: ellipsis\"><h2>" 
                                    + resource["Company"] + "</h2></a>";
                                if (resource["Category/Subject"] != undefined && 
                                        resource["Category/Subject"].trim() != "") {
                                    html += "<b>Category/Subject</b> &nbsp;&nbsp" + 
                                                resource["Category/Subject"] + "<br />";
                                }
                                if (resource["Grade/Age Group"] != undefined &&
                                    resource["Grade/Age Group"].trim() != "") {
                                    html += "<b>Grade/Age Group</b> &nbsp;&nbsp" + 
                                                resource["Grade/Age Group"] + "<br />";
                                }
                                html += resource["Description"] + "<br />";
                                html += "<b>Free Service Offered</b> &nbsp;&nbsp" + 
                                    resource["Free Service Offered"] + "<br /><br />";
                            });
                            element.innerHTML = html;
                        }
                        if (window.allResources) {
                            setCurrentList();
                        } else {
                            var xhr = new XMLHttpRequest();
                            xhr.open('get', 'AmazingMathResouces.csv');
                            xhr.onload = function() {
                                if (this.readyState === 4) {
                                    if (this.status == 200) {
                                    try {
                                        window.allResources = Papa.parse(this.responseText, {header: true});
                                        setCurrentList();
                                    } catch (e) {
                                        console.log(e);
                                        alert("error reading resource list: " + this.responsetext);
                                    }
                                    } else {
                                        alert(this.responsetext);
                                    }
                                } else {
                                    // ignore other events for request still in progress
                                }
                            };
                            xhr.send();
                        }
                    }
                </script>
	</head>
	<body onload="onLoad()">

		<!-- Header -->
			<header id="header">
				<div class="inner">
					<a href="index.html" class="logo">
						Amazing Educational Resources</a>
					<nav id="nav">
						<a href="suggestions.html">About</a>
					</nav>
				</div>
			</header>
			<a href="#menu" class="navPanelToggle"><span class="fa fa-bars"></span></a>

		<!-- Banner 
			<section id="banner">
				<div class="inner">
					<h1>Introspect: <span>A free + fully responsive<br />
					site template by TEMPLATED</span></h1>
					<ul class="actions">
						<li><a href="#" class="button alt">Get Started</a></li>
					</ul>
				</div>
			</section>
                -->
		<!-- One -->
			<section id="one">
				<div class="inner">
                                    <h2><a href="suggestions.html">
					Have Suggestions for Materials to Add? Or a Correction?</a></h2>
                                    <h3>
					<div style="display:inline-block">
				        <div>Subject</div>
                                        <div class="select-wrapper" style="display:inline-block">
                                            <select name="subjectValue" id="subjectValue" onchange="onLoad()">
						<option value=""></option>
						<option value="Math">Math</option>
						<option value="Reading">Reading</option>
						<option value="Science">Science</option>
						<option value="Writing">Writing</option>
						<option value="Social Studies">Social Studies</option>
						<option value="Fine Arts">Fine Arts</option>
						<option value="ESL">ESL</option>
						<option value="Foreign Language">Foreign Language</option>
						<option value="Physical Education">Physical Education</option>
						<option value="Early Childhood">Early Childhood</option>
						<option value="Special Education">Special Education</option>
						<option value="STEM">STEM</option>
						<option value="Intervention Resources">Intervention Resources</option>
						<option value="Counseling">Counseling</option>
					    </select>
					</div>&nbsp;&nbsp;
					</div>
					<div style="display:inline-block">
				        <div>Grade Level</div>
                                        <div class="select-wrapper" style="display:inline-block">
                                            <select name="levelValue" id="levelValue" onchange="onLoad()">
						<option value=""></option>
						<option value="Early Childhood">Early Childhood</option>
						<option value="K - 2nd">K - 2nd</option>
						<option value="3rd - 5th">3rd - 5th</option>
						<option value="High School">High School</option>
						<option value="Higher Education">Higher Education</option>
					    </select>
					</div>
					</div>
					 <div style="margin-left:20px;display:inline-block">
					       <input type="checkbox" name="alwaysFree"
							id="alwaysFree" onchange="onLoad()"/>
					       <label for="alwaysFree">Always Free</label>
					</div>&nbsp;&nbsp;

                                        <input type="text" id="searchBox" style="display:inline-block"
					       onchange="onLoad()"/>
                                        <input type="submit" value="Search" onsubmit="onLoad()" style="display:inline-block"/>
                                    </h3>
                                </div>
				<div class="inner" id="resourceList">
					Loading List of Resources...
				</div>
			</section>
		<!-- Footer -->
			<section id="footer">
				<div class="inner">
					<header>
						<h2>Amazing Educational Resources</h2>
					</header>

					<div class="copyright">
						&copy; Amazing Educational Resources - 
						<a href="https://templated.co/introspect">
						Based on templated.co Introspect site template.</a>. 
					</div>
				</div>
			</section>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
